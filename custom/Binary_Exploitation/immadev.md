# immadev

 Was provided with a binary used IDA to decompile after initial static analysis using `strings` and `file`. 

At initial analysis, the decompiled code most likely is C++ code.  

Functions present in the program:
```
main()
handleOption()
login()
printFlag() 
```

After examining the code, the function `handleOption()` is the one, which is of our concern:

```cpp
unsigned __int64 handleOption()
{
  __int64 v0; // rax
  __int64 v1; // rax
  int v2; // eax
  _QWORD *v3; // rax
  __int64 v6; // rax
  int v7; // eax
  int v9; // [rsp+4h] [rbp-5CCh] BYREF
  int v10; // [rsp+8h] [rbp-5C8h]
  int i; // [rsp+Ch] [rbp-5C4h]
  _BYTE v12[32]; // [rsp+10h] [rbp-5C0h] BYREF
  _BYTE v13[384]; // [rsp+30h] [rbp-5A0h] BYREF
  _DWORD v14[258]; // [rsp+1B0h] [rbp-420h]
  unsigned __int64 v15; // [rsp+5B8h] [rbp-18h]

  v15 = __readfsqword(0x28u);
  v10 = 0;
  std::string::basic_string(v12);
  std::getline<char,std::char_traits<char>,std::allocator<char>>(&std::cin, v12);
  std::istringstream::basic_istringstream(v13, v12, 8);
  while ( 1 )
  {
    v3 = (_QWORD *)std::istream::operator>>(v13, &v9);
    if ( !(unsigned __int8)std::ios::operator bool((char *)v3 + *(_QWORD *)(*v3 - 24LL)) || v10 > 255 )
      break;
    if ( v9 > 0 && v9 <= 3 )
    {
      v2 = v10++;
      v14[v2] = v9;
    }
    else
    {
      v0 = std::operator<<<std::char_traits<char>>(&std::cout, "Ignoring invalid option: ");
      v1 = std::ostream::operator<<(v0, (unsigned int)v9);
      std::ostream::operator<<(v1, &std::endl<char,std::char_traits<char>>);
    }
  }
  if ( v14[0] == 2 && geteuid() )
  {
    v6 = std::operator<<<std::char_traits<char>>(&std::cout, "Error: Option 2 requires root privileges HAHA");
    std::ostream::operator<<(v6, &std::endl<char,std::char_traits<char>>);
  }
  else
  {
    for ( i = 0; i < v10; ++i )
    {
      v7 = v14[i];
      if ( v7 == 3 )
      {
        login();
      }
      else if ( v7 <= 3 )
      {
        if ( v7 == 1 )
        {
          sayHello();
        }
        else if ( v7 == 2 )
        {
          printFlag();
        }
      }
    }
  }
  std::istringstream::~istringstream(v13);
  std::string::~string(v12);
  return v15 - __readfsqword(0x28u);
}
```

This is the part of the code, that is important: 
```c
if ( v14[0] == 2 && geteuid() )
  {
    v6 = std::operator<<<std::char_traits<char>>(&std::cout, "Error: Option 2 requires root privileges HAHA");
    std::ostream::operator<<(v6, &std::endl<char,std::char_traits<char>>);
  }
```

It only checks if `v14[0]` is 2 and if the root user is running, if `v14[1]` is 2, then it will run the else condition and give the flag. 

```
> nc immadeveloper.nitephase.live 61234
 Hi I'm sudonymouse!
I'm learning development, checkout this binary!
Option 1: Hello <USER>
Option 2: Flag(maybe?)
Option 3: Log into my binary!
1 2
Input your name: hello
Hi hello
nite{n0t_4ll_b1n3x_15_st4ck_b4s3d!}
```

I put `1 2` as input and got the flag.  

**flag** `nite{n0t_4ll_b1n3x_15_st4ck_b4s3d!}`

#### Important notes: 

Not all Binary Exploitation problems are stack based. I went on multiple tangents, tried buffer overflow and format strings. 
Examine the decompiled code properly to exploit logical errors for vulnerabilities.




